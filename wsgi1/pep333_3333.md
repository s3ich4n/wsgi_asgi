# PEP 333, PEP 3333

+ 웹 서버와 파이썬 웹 앱/프레임워크와의 인터페이스를 제안한 문서
    + 이 문서는 2003년에 최초로 생성되었다
+ Python 3 버전에 맞추어서 새로 나온 PEP 3333을 같이 봐야한다

## Rationale and Goals

+ 그 시절 파이썬도 웹 애플리케이션이 많이 등장했으나, 웹 서버-웹 앱의 선택이 한정적이었다.
+ 그 시절 자바는 servlet API 를 통해 어떤 자바 앱이든 servlet API 로 웹 서버-웹 앱 간 상호작용이 가능했다.
+ 옛날 파이썬은 웹 통신을 위한 구현체가 따로따로 있었다
  + 예를 들어...
    + 파이썬으로 작성된 웹서버 ([Medusa, 아카이브](https://github.com/lispyclouds/medusa))
    + 웹 서버에 임베딩되어 쓰이는 형식 ([mod_python, 코드는 관리되나 더이상 업데이트 없음](https://github.com/grisha/mod_python))
    + 게이트웨이 프로토콜을 통해 파이썬을 호출한 방식 ([CGI, 정의만 있음](https://www.w3.org/CGI/), FastCGI)
      + CGI(Common Gateway Interface)는 다음에 더 추가적으로 설명하도록 한다...
+ PEP 333은 이런 불편을 덜기 위해 **_웹 서버-웹 앱 간의 인터페이스를 WSGI(Python Web Server Gateway Interface)를 제안_** 한 내용이다.
+ 그 외의 내용은 실제 WSGI를 설계 및 구현시에 관련된 내용이므로 과감히 생략하도록 한다.

## Specification Overview

+ WSGI 인터페이스는 "서버(혹은 게이트웨이)" 사이드, "앱(혹은 프레임워크) 사이드" 가 있다.
+ 서버 사이드는 `Callable` 객체를 호출한다. 이 객체는 앱 사이드에서 제공하는 값이다.
  + Callable 객체가 어떻게 제공되는지는 서버/게이트웨이가 하기 나름이다.
    + 일부 서버 또는 게이트웨이는 응용 프로그램 배포자가 서버 또는 게이트웨이의 인스턴스를 만들고
      응용 프로그램 개체와 함께 제공하는 짧은 스크립트를 작성해야 한다고 가정합니다. 
    + 다른 서버 및 게이트웨이는 구성 파일 또는 기타 메커니즘을 사용하여 응용 프로그램 개체를 가져오거나
      다른 방식으로 가져와야 하는 위치를 지정할 수 있습니다.

+ 서버/게이트웨이, 앱/프레임워크 사이에 존재하는 "미들웨어"라는 것을 구현할 수 있다
  + 이는 "미들웨어"를 포함하는 서버의 앱처럼 쓰일 수도 있다
  + 확장 API, 컨텐츠 변환, 탐색 등의 기타 유용한 기능을 추가로 제공해줄 수 있다

+ 위에서 말한 `Callable`은 `__call__()` 메소드를 구현한 객체를 의미한다.
  + 구현은 알아서 하면 되지만, 호출할 때는 어떤 종류의 `Callable`이 호출되었는지 알지 모르게 해야한다(종속성 제거).
  + 해당 콜러블은 자체검사되진 않는다

### `String` 타입 처리에 대하여

+ HTTP 는 일반적으로 `bytes` 처리를 한다. 이말은, 이 스펙의 경우 `bytes` 객체를 처리하는것과 연관있다는 뜻이다.

+ 많은 파이썬 구현체는 3.x 버전 이상에서는 문자열이 유니코드로 처리된다.
  + 코드 작성자는 API와 HTTP 컨텍스트간 번역을 잘 작성해야한다.
  + 파이썬 구현체 간의 다른 `str` 처리를 위해서라도 잘 처리해야한다.

+ 그러므로, WSGI는 두가지 "문자열"을 정의한다.
  + 요청/응답 헤더 및 메타데이터에 쓰이는 네이티브 문자열("Native" 문자열)
  + 요청/응답 본문에 쓰이는 바이트 문자열(`Bytestrings`)
  + 그러나, 내부적으로 유니코드로 어찌 처리되든간에
    파이썬 `str` 유형은 `Latin-1` 인코딩을 통해 바이트로 변환 가능해야한다. (하기 내용 참고)
    + "문자열"은 "Native" 문자열로
    + `bytestrings` 처리는...
      + Python 3에서는 `bytes` 로
      + Python 2에서는 `str` 유형의 객체로

### 미들웨어

## 스펙 상세

### `environ` 변수

#### Input, Error 스트림

### `start_response` Callable.

#### `Content-Length` 헤더 처리

### 버퍼링, 스트리밍

### 유니코드 처리

### 에러 처리

### HTTP 1.1 "expect/continue" 메커니즘 처리
